<!-- HTML header for doxygen 1.13.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=11"/>
  <meta name="generator" content="Doxygen 1.12.0"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Nuke.Cola: Folder Composition</title>
  <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../jquery.js"></script>
  <script type="text/javascript" src="../../dynsections.js"></script>
  <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
  <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
  <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
  <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
      DoxygenAwesomeParagraphLink.init()
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeTabs.init()
      DoxygenAwesomeFragmentCopyButton.init()
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="../../nuke.cola.text.onDark.small.png"/></td>
              <td id="projectalign">
                <div id="projectname">Nuke.Cola
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('da/d82/FolderComposition.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Folder Composition</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md4">Regular folders</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md5">Folders with export manifest</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md6">Exclude/ignore items</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_Manual_2FolderComposition"></a></p>
<p>There are cases when one project needs to compose from one pre-existing rigid folder structure of one dependency to another rigid folder structure of the current project. For scenarios like this <a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a> provides <code>ImportFolder</code> build class extension method which will copy/link the target folder and its contents according to some instructions expressed by either a YAML manifest file (by default <code>export.yml</code>) in the imported folder or provided explicitly to the <code>ImportFolder</code> extension method.</p>
<p>For example the following target:</p>
<div class="fragment"><div class="line">[ImplicitBuildInterface]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IImportTestFolders : INukeBuild</div>
<div class="line">{</div>
<div class="line">    Target ImportTestFolders =&gt; _ =&gt; _</div>
<div class="line">        .Executes(() =&gt; </div>
<div class="line">        {</div>
<div class="line">            var root = this.ScriptFolder();</div>
<div class="line">            var target = root / <span class="stringliteral">&quot;Target&quot;</span>;</div>
<div class="line">            var thirdparty = root / <span class="stringliteral">&quot;ThirdParty&quot;</span>;</div>
<div class="line"> </div>
<div class="line">            this.ImportFolders(</div>
<div class="line">                <span class="keyword">new</span> ImportOptions(Suffixes: <span class="stringliteral">&quot;Test&quot;</span>)</div>
<div class="line">                , (thirdparty / <span class="stringliteral">&quot;Unassuming&quot;</span>, target)</div>
<div class="line">                , (thirdparty / <span class="stringliteral">&quot;FolderOnly_Origin&quot;</span>, target)</div>
<div class="line">                , (thirdparty / <span class="stringliteral">&quot;WithManifest&quot;</span> / <span class="stringliteral">&quot;Both_Origin&quot;</span>, target / <span class="stringliteral">&quot;WithManifest&quot;</span>)</div>
<div class="line">                , (thirdparty / <span class="stringliteral">&quot;WithManifest&quot;</span> / <span class="stringliteral">&quot;Copy_Origin&quot;</span>, target / <span class="stringliteral">&quot;WithManifest&quot;</span>)</div>
<div class="line">                , (thirdparty / <span class="stringliteral">&quot;WithManifest&quot;</span> / <span class="stringliteral">&quot;Link_Origin&quot;</span>, target / <span class="stringliteral">&quot;WithManifest&quot;</span>)</div>
<div class="line">            );</div>
<div class="line">        });</div>
<div class="line">}</div>
</div><!-- fragment --><p>will process/import the file/folder structure on the left to the file/folder structure on the right.</p>
<div class="fragment"><div class="line">ThirdParty                                  -&gt;  Target</div>
<div class="line">├───FolderOnly_Origin                       -&gt;  ├───FolderOnly_Test &lt;symlink&gt;</div>
<div class="line">│       SomeFile_B.txt                          │       *</div>
<div class="line">├───Unassuming                              -&gt;  ├───Unassuming &lt;symlink&gt;</div>
<div class="line">│       SomeFile_A.txt                          │       *</div>
<div class="line">└───WithManifest                            -&gt;  └───WithManifest</div>
<div class="line">    ├───Both_Origin                         -&gt;      ├───Both_Test</div>
<div class="line">    │   │   export.yml                              │   │   -</div>
<div class="line">    │   │   SomeModule_Origin.build.txt     -&gt;      │   │   SomeModule_Test.build.txt</div>
<div class="line">    │   ├───ExcludedFolder                          │   │   -</div>
<div class="line">    │   │       SomeFile_Excluded.txt               │   │       -</div>
<div class="line">    │   ├───Private                         -&gt;      │   ├───Private</div>
<div class="line">    │   │   │   ModuleFile_Origin.cpp.txt   -&gt;      │   │   │   ModuleFile_Test.cpp.txt</div>
<div class="line">    │   │   └───SharedSubfolder             -&gt;      │   │   └───SharedSubfolder &lt;symlink&gt;</div>
<div class="line">    │   │           SomeFile.cpp.txt                │   │           *</div>
<div class="line">    │   └───Public                          -&gt;      │   └───Public</div>
<div class="line">    │       └───SharedSubfolder             -&gt;      │       └───SharedSubfolder &lt;symlink&gt;</div>
<div class="line">    │               SomeFile.h.txt                  │               *</div>
<div class="line">    ├───Copy_Origin                         -&gt;      ├───Copy_Test</div>
<div class="line">    │   │   export.yml                              │   │   -</div>
<div class="line">    │   ├───Foo                             -&gt;      │   ├───Foo</div>
<div class="line">    │   │   │   Foo.bar                     -&gt;      │   │   │   Foo.bar</div>
<div class="line">    │   │   └───Bar_Origin                  -&gt;      │   │   └───Bar_Test</div>
<div class="line">    │   │           A.txt                   -&gt;      │   │           A.txt</div>
<div class="line">    │   └───Wizzard                         -&gt;      │   └───Wizzard</div>
<div class="line">    │       │   B.txt                       -&gt;      │       │   B.txt</div>
<div class="line">    │       └───Ech                         -&gt;      │       └───Ech_Test</div>
<div class="line">    │               C_Origin.txt            -&gt;      │               C_Test.txt</div>
<div class="line">    └───Link_Origin                         -&gt;      └───Link_Test</div>
<div class="line">        │   export.yml                                  │   -</div>
<div class="line">        ├───Foo                             -&gt;          ├───Foo</div>
<div class="line">        │   │   Foo.bar                     -&gt;          │   │   Foo.bar</div>
<div class="line">        │   └───Bar_Origin                  -&gt;          │   └───Bar_Test &lt;symlink&gt;</div>
<div class="line">        │           A.txt                               │           *</div>
<div class="line">        └───Wizzard                         -&gt;          └───Wizzard</div>
<div class="line">            │   B_Origin.txt                -&gt;              │   B_Test.txt &lt;symlink&gt;</div>
<div class="line">            └───Ech_Origin                  -&gt;              └───Ech_Test</div>
<div class="line">                    C_Origin.txt            -&gt;                      C_Test.txt &lt;symlink&gt;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The resulting file/folder structure is also controlled by the <code>export.yml</code> files which content is not explicitly spelled out here, and is discussed further below.</dd></dl>
<p>To break it down:</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Regular folders</h1>
<p>A regular folder (like <code>Unassuming</code>) with no extra import instructions provided will be just symlinked.</p>
<p>Optionally folders and files containing a preset suffix (for example and by default <code>Origin</code> with either <code>_</code>, <code>.</code> and <code>:</code> as separators) can be replaced by another suffix chosen by the importing script (in this case <code>Test</code>). Files/Folders linked or copied will have this suffix replaced at their destination. (see <code>FolderOnly_Origin</code> -&gt; <code>FolderOnly_Test</code>). If <code>Suffixes</code> were not specified in <code>ImportOptions</code> or if <code>ImportOptions</code> is not provided at all, suffix processing is skipped.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Folders with export manifest</h1>
<p>Folders can dictate the intricacies of how they're shared this way with a simple YAML manifest file (by default called <code>export.yml</code> but this can be changed). For example the one in <code>Both_Test</code> does</p>
<div class="fragment"><div class="line">link:</div>
<div class="line">  - dir: Private/SharedSubfolder          # Simply link single subfolder at destination maintaining structure</div>
<div class="line">  - dir: Public/SharedSubfolder           # Simply link single subfolder at destination maintaining structure</div>
<div class="line">  - dir: Some/Deep/Folder/For/Some/Reason # Map a deep folder structure into a singular level</div>
<div class="line">    as: MyNiceFolder</div>
<div class="line">copy:</div>
<div class="line">  - file: &quot;**/*_Origin.*&quot; # Individually and recursively copy every file with a suffix &quot;_Origin&quot; maintaining subfolder structure</div>
<div class="line">    procContent: true     # also replace [_.:]Origin suffixes in the content of files (controlled by the importer)</div>
</div><!-- fragment --><p>Linking folders is straightforward and globbable. If suffixes are provided target folders and parent folders (up until export root) is processed for suffixes at destination same as when copying folders.</p>
<p>When linking files, globbed files are individually symlinked, optionally with suffix processing on file/folder name.</p>
<p>Copying folders recursively have the same folder name processing but doesn't touch its contents (not even file/folder name processing)</p>
<p>When copying files (including when they're globbed) their content can be also processed for suffixes if <code>procContent</code> is set to true and suffixes are enabled. Copying an entire folder recursively but with all the file/folder names processed can be done by simply doing recursive globbing <code>-file: "MyFolder/**"</code>. The reasoning behind this design is suggesting performance implications, that each file is individually treated.</p>
<p>The destination relative path and name can also be overridden with <code>as:</code>. This works with globbing as well where the captures of <code>*</code> and <code>**</code> can be referred to as <code>$N</code> where N is the 1 based index of the wildcards. For example</p>
<div class="fragment"><div class="line">- file: Flatten/**/*.txt # Select all text files arbitrarily deep inside subfolder structure</div>
<div class="line">  as: Flatten/$2.txt     # copy/link them in a singular folder referencing the second wildcard</div>
</div><!-- fragment --><p>Where all the files inside the recursive structure of subfolder <code>Flatten</code> is copied/linked into a single-level subfolder. <code>$2</code> in <code>as:</code> indicates it uses the second wildcard (the one at <code>*.txt</code>).</p>
<p>Export manifests can reference other export manifests when they're listed under <code>use</code> key the same way as copies or links are done, for example:</p>
<div class="fragment"><div class="line">use:</div>
<div class="line">  - dir: Subfolder/MyDependency         # will export subfolder to destination maintaining subfolder structure</div>
<div class="line">  - dir: Components/*                   # consider using all direct subfolders inside components folder</div>
<div class="line">  - dir: Components/**                  # consider using all recursive subfolders inside components folder</div>
<div class="line">  - dir: Components/**/*                # consider using all recursive subfolders inside components folder BUT</div>
<div class="line">    as: Components/$2                   # flatten them into a single subfolder</div>
<div class="line">    manifestFilePattern: flat.yml       # and use `flat.yml` as export manifests</div>
<div class="line">  - dir: &quot;**&quot;                           # just use everything from the recursive subfolder structure which has an export.yml (by default)</div>
<div class="line">  - file: Another/Dependency/stuff.yml  # use an explicit file for the manifest being imported</div>
</div><!-- fragment --><p>This feature is not visualized above in the folder structure figure as that's already complicated enough. Note that <code>copy</code> and <code>link</code> will not consider instructions from export manifest files, only <code>use</code> does that, and <code>use</code> will ignore every folder which doesn't have an export manifest file directly in it. This is done this way to alleviate surprises from "smart defaults".</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Exclude/ignore items</h1>
<p>There are cases when it's easier to have an explicit rule for ignoring files/folders from a generic match, instead of composing a match for wide range of files, but the ones we want to exclude. For this reason folder composition allows to list patterns which will exclude matched paths. They can be declared for all the exported folder, or individual glob items.</p>
<div class="fragment"><div class="line">copy:</div>
<div class="line">  - file: Folder/**/*   # copy everything from Folder</div>
<div class="line">    not:</div>
<div class="line">      - &quot;.*/&quot;           # except dot folders</div>
<div class="line">      - &quot;*.generated.*&quot; # except &quot;generated&quot; files</div>
<div class="line">  - dir: Source         # above exceptions don&#39;t apply here</div>
<div class="line">not:</div>
<div class="line">  - Intermediate/       # Ignore intermediate folders in all entries.</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For now "ignore files" like <code>.gitignore</code> are not considered, but in the future there may be a feature which ignores files the way git does with <code>.gitignore</code> upon request. Until that time copying entries from your gitignore to <code>not:</code> fields as an array should do the same, if that is indeed the preferred behavior.</dd></dl>
<details >
<summary >
<b>NOTE</b> about string values in YAML containing *</summary>
<p></p>
<p><code>*</code> in YAML has special meaning. Therefore string values containing <code>*</code> needs to be single or double quoted. Therefore</p>
<div class="fragment"><div class="line">copy:</div>
<div class="line">  - file: **/*_Origin.* # ERROR</div>
</div><!-- fragment --><div class="fragment"><div class="line">copy:</div>
<div class="line">  - file: &quot;**/*_Origin.*&quot; # OK</div>
<div class="line">  - file: &#39;**/*_Origin.*&#39; # OK</div>
</div><!-- fragment --><p></p>
</details>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
