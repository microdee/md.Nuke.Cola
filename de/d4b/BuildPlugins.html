<!-- HTML header for doxygen 1.13.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=11"/>
  <meta name="generator" content="Doxygen 1.12.0"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Nuke.Cola: Build Plugins</title>
  <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../jquery.js"></script>
  <script type="text/javascript" src="../../dynsections.js"></script>
  <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
  <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
  <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
  <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="../../doxygen-awesome-tabs.js"></script>
  <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
      DoxygenAwesomeParagraphLink.init()
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeTabs.init()
      DoxygenAwesomeFragmentCopyButton.init()
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectlogo"><img alt="Logo" src="../../nuke.cola.text.onDark.small.png"/></td>
              <td id="projectalign">
                <div id="projectname">Nuke.Cola
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('de/d4b/BuildPlugins.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build Plugins</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md0">ImplicitBuildInterface plugins</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md1">nuke.csx C# script plugins</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md2">Nuke.csproj C# project plugins</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md3">Disable re-discovering plugins</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_Manual_2BuildPlugins"></a></p>
<p>Build plugins for <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> is a way to implicitly share build tasks which the main build tool can pick up automatically from anywhere within the project. For components which are independent of each-other but they don't individually make a complete project, like a composition of those are expressing the resulting piece of software, it might not make sense for them to have independent full fledged <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> context for each of them. For these scenarios <a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a> provides a way to discover C# scripts or C# projects following a specific convention anywhere inside the subfolders of the project (recursively). These plugins can be then just distributed and re-used along these components.</p>
<details >
<summary >
Practical justification / reasoning / motivation</summary>
<p></p>
<p>This is originally developed for Unreal plugins where the main project's <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> scripts or the pre-built independently distributed build-tools shouldn't explicitly know about the plugin composition of the project they need to work on in runtime. Unreal, or other non-dotnet project models might not have the capacity or cultural acceptance to rely on a Nuget infrastructure to distribute build scripts of these independent software components, which then could be referenced by the main project. Even if that would be plausable it would still take uncomfortable extra boilerplate for each of these software components. In case of a pre-built build tool based on a <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> build script, this is the only way I know of to have dynamically composable software component specific build scripts considered.</p>
<p></p>
</details>
<p>Build plugins are discovered before the main entry point of <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a>, if the developer uses</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">int</span> Main () =&gt; Plugins.Execute&lt;Build&gt;(Execute);</div>
</div><!-- fragment --><details >
<summary >
instead of the traditional</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">int</span> Main () =&gt; Execute&lt;Build&gt;(x =&gt; x.Compile);</div>
</div><!-- fragment --><p></p>
</details>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Your main Build class needs to be <code>public</code> for this to work.</li>
<li>Currently it is not yet implemented to support an explicit default target, so when <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> is executed without arguments, it will just print the help text.</li>
</ul>
</dd></dl>
<p>The following kinds of plugins discovered this way:</p>
<ul>
<li><code>*.nuke.csx</code> standalone C# script files.</li>
<li><code>*.Nuke.csproj</code> named C# projects.</li>
<li><code>[ImplicitBuildInterface]</code> tagged interfaces in the main build.</li>
</ul>
<p>Scripts are better when there's a single file with few targets which don't need to interact with the main build class, projects are better for more elaborate scenarios and <code>[ImplicitBuildInterface]</code> can be used when <code>&lt;Compile Include="../**/*.nuke.cs" /&gt;</code> is specified for the build project.</p>
<p>In all cases build interfaces inheriting <code>INukeBuild</code> are picked up and their targets and parameters are added to the final <a class="el" href="../../df/da7/namespaceNuke.html">Nuke</a> build class. <a href="https://nuke.build/docs/sharing/build-components/">Read more about Nuke build interfaces</a> (or "Build Components" as they call it). Targets of Plugins have complete freedom to interact with the entire build graph, especially when the build graph is expressed first in a Nuget package library (like <a href="https://github.com/microdee/Nuke.Unreal">Nuke.Unreal</a> already gives Unreal plugins a lot to work with).</p>
<h1><a class="anchor" id="autotoc_md0"></a>
ImplicitBuildInterface plugins</h1>
<p>This is simply an interface defined in your main build project. It may not seem very useful until one factors in the following addition to your build csproj:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">ItemGroup</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">Compile</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;../**/*.nuke.cs&quot;</span> /&gt;</div>
<div class="line">&lt;/<span class="keywordtype">ItemGroup</span>&gt;</div>
</div><!-- fragment --><p>This means that without any further configuration one can put <code>.nuke.cs</code> files anywhere in their project and write scripts in the context of their placement. This is the easiest to configure method requiring the least bboilerplate but obviously it doesn't work on pre-built nuke build-tools.</p>
<details >
<summary >
except...</summary>
<p></p>
<p>if one creates a <code>csproj</code> based build plugin which sole purpose is to include source files that way. In that case the prebuilt build tool can discover <code>.nuke.cs</code> files provided when compiling the <code>csproj</code> plugin.</p>
<p></p>
</details>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Nuke.Common;</div>
<div class="line"><span class="keyword">using </span>Nuke.Unreal;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a>;</div>
<div class="line"><span class="keyword">using </span>Serilog;</div>
<div class="line"> </div>
<div class="line">[ImplicitBuildInterface]</div>
<div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IExtraTargets : INukeBuild</div>
<div class="line">{</div>
<div class="line">    Target TestPlugin =&gt; _ =&gt; _</div>
<div class="line">        .DependentFor&lt;UnrealBuild&gt;(b =&gt; b.Generate)</div>
<div class="line">        .Executes(() =&gt;</div>
<div class="line">        {</div>
<div class="line">            Log.Information($<span class="stringliteral">&quot;Hello from folder {this.ScriptFolder()}&quot;</span>);</div>
<div class="line">        });</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceNuke_1_1Cola_html"><div class="ttname"><a href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/d93/Arguments_8cs_source.html#l00009">Arguments.cs:9</a></div></div>
</div><!-- fragment --><details >
<summary >
Open for detailed explanation:</summary>
<p></p>
<div class="fragment"><div class="line"><span class="keyword">using </span>Nuke.Common;</div>
<div class="line"><span class="keyword">using </span>Nuke.Unreal;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a>;</div>
<div class="line"><span class="keyword">using </span>Serilog;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This attribute is necessary so other optional build components wouldn&#39;t get used unexpectedly</span></div>
<div class="line">[ImplicitBuildInterface]</div>
<div class="line"><span class="comment">// The build component interface should only declare members with default implementations</span></div>
<div class="line"><span class="comment">// as there&#39;s no manual way to provide those in the implementing intermediate build class.</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IExtraTargets : INukeBuild</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Define your targets or parameters freely and connect them with the build graph</span></div>
<div class="line">    <span class="comment">// OR the developer can explicitly call them with `nuke test-plugin` in this case</span></div>
<div class="line">    Target TestPlugin =&gt; _ =&gt; _</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Automatically run this target before the Generate target is invoked.</span></div>
<div class="line">        <span class="comment">// `UnrealBuild` is a base build class providing common Unreal related targets and</span></div>
<div class="line">        <span class="comment">// parameters, including `Generate`.</span></div>
<div class="line">        .DependentFor&lt;UnrealBuild&gt;(b =&gt; b.Generate)</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Finally declare what this target should actually do when invoked</span></div>
<div class="line">        .Executes(() =&gt;</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Use this.ScriptFolder() to work with this file&#39;s location</span></div>
<div class="line">            Log.Information($<span class="stringliteral">&quot;Hello from folder {this.ScriptFolder()}&quot;</span>);</div>
<div class="line">        });</div>
<div class="line">}</div>
</div><!-- fragment --><p><a href="https://nuke.build/docs/fundamentals/targets/">Read more about target definitions in NUKE.</a></p>
<p></p>
</details>
<h1><a class="anchor" id="autotoc_md1"></a>
nuke.csx C# script plugins</h1>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#r &quot;nuget: md.Nuke.Unreal, 2.0.5&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>Nuke.Common;</div>
<div class="line"><span class="keyword">using </span>Nuke.Unreal;</div>
<div class="line"><span class="keyword">using </span>Serilog;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IExtraTargets : INukeBuild</div>
<div class="line">{</div>
<div class="line">    Target TestPlugin =&gt; _ =&gt; _</div>
<div class="line">        .DependentFor&lt;UnrealBuild&gt;(b =&gt; b.Generate)</div>
<div class="line">        .Executes(() =&gt;</div>
<div class="line">        {</div>
<div class="line">            Log.Information($<span class="stringliteral">&quot;Hello from folder {this.ScriptFolder()}&quot;</span>);</div>
<div class="line">        });</div>
<div class="line">}</div>
</div><!-- fragment --><details >
<summary >
Open for detailed explanation:</summary>
<p></p>
<div class="fragment"><div class="line"><span class="preprocessor">#r &quot;nuget: md.Nuke.Unreal, 2.0.5&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>Nuke.Common;</div>
<div class="line"><span class="keyword">using </span>Nuke.Unreal;</div>
<div class="line"><span class="keyword">using </span>Serilog;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The build component interface should only declare members with default implementations</span></div>
<div class="line"><span class="comment">// as there&#39;s no manual way to provide those in the implementing intermediate build class.</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IExtraTargets : INukeBuild</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Define your targets or parameters freely and connect them with the build graph</span></div>
<div class="line">    <span class="comment">// OR the developer can explicitly call them with `nuke test-plugin` in this case</span></div>
<div class="line">    Target TestPlugin =&gt; _ =&gt; _</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Automatically run this target before the Generate target is invoked.</span></div>
<div class="line">        <span class="comment">// `UnrealBuild` is a base build class providing common Unreal related targets and</span></div>
<div class="line">        <span class="comment">// parameters, including `Generate`.</span></div>
<div class="line">        .DependentFor&lt;UnrealBuild&gt;(b =&gt; b.Generate)</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Finally declare what this target should actually do when invoked</span></div>
<div class="line">        .Executes(() =&gt;</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Use this.ScriptFolder() to work with this file&#39;s location</span></div>
<div class="line">            Log.Information($<span class="stringliteral">&quot;Hello from folder {this.ScriptFolder()}&quot;</span>);</div>
<div class="line">        });</div>
<div class="line">}</div>
</div><!-- fragment --><p><a href="https://nuke.build/docs/fundamentals/targets/">Read more about target definitions in NUKE.</a></p>
<p></p>
</details>
<p>You can put a <code>*.nuke.csx</code> file anywhere and it will be picked up as a Build Plugin. <code><a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a></code> will also configure VSCode for C# scripts auto-completion support as common courtasy. In order for VSCode to pick up nuget references use <code>.NET: Restart Language Server</code> via the command palette (or <code>Omnisharp: Restart OmniSharp</code> in case that fallback is used). Debugging plugins require you to modify <code>.vscode/launch.json</code> and run the desired targets/parameters as startup. Mutliple scripts with the same name in different folders can co-exist as long as they define unique interface names.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Nuke.csproj C# project plugins</h1>
<p>You can put a <code>*.Nuke.csproj</code> named project anywhere and the build script using <code><a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a></code> will pick it up. Simplest way to do it is via dotnet command line:</p>
<div class="fragment"><div class="line">&gt; dotnet new classlib --name MyPlugin.Nuke</div>
</div><!-- fragment --><p>then add <code><a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a></code> Nuget package (and your own project's specific shared build components):</p>
<div class="fragment"><div class="line">&gt; cd .\MyPlugin.Nuke</div>
<div class="line">&gt; dotnet package add md.Nuke.Cola</div>
</div><!-- fragment --><p>and then you can proceed as with any other dotnet class library.</p>
<dl class="section note"><dt>Note</dt><dd>Unlike scripts, each C# project build plugin needs to be named uniquely in one project.</dd></dl>
<h1><a class="anchor" id="autotoc_md3"></a>
Disable re-discovering plugins</h1>
<p>Building plugins can take a long time, and if nuke is run repeatedly this can get worse pretty quickly. For this reason if <code>REUSE_COMPILED</code> environment variable is set to 1 or <code>--ReuseCompiled</code> is present in command line arguments, plugins are only re-built / re-discovered the first time they're needed. Consecutive runs assume that nothing is changed.</p>
<p>This is useful for CI runs or when nuke is run frequently locally.</p>
<p>As an extra <a class="el" href="../../d5/d78/namespaceNuke_1_1Cola.html">Nuke.Cola</a> provides <code>build.ps1</code> / <code>build.sh</code> entry points which also respect these indicators, so they can skip directly to executing the build without going through all the checks and preparations. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
